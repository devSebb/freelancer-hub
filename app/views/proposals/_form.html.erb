<%= form_with model: proposal, class: "space-y-6" do |f| %>
  <% if proposal.errors.any? %>
    <div class="bg-red-400/10 border border-red-400/20 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <%= icon(:error, variant: :duotone, size: :sm, css_class: "text-red-400 flex-shrink-0 mt-0.5") %>
        <ul class="text-sm text-red-400 space-y-1">
          <% proposal.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <!-- Client & Title -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
      <div>
        <%= f.label :client_id, t("proposals.client"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <%= f.collection_select :client_id, current_user.clients.order(:name), :id, :name,
            { prompt: t("proposals.select_client"), include_blank: false },
            { class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors" } %>
      </div>

      <div>
        <%= f.label :title, t("proposals.title_field"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <%= f.text_field :title, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", required: true, placeholder: t("proposals.title_placeholder") %>
      </div>
    </div>
  </div>

  <!-- Scope & Deliverables -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6 space-y-5">
    <div>
      <%= f.label :scope, t("proposals.scope"), class: "block text-sm font-medium text-white/70 mb-2" %>
      <%= f.text_area :scope, rows: 4, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors resize-none", placeholder: t("proposals.scope_placeholder") %>
    </div>

    <div>
      <%= f.label :deliverables, t("proposals.deliverables"), class: "block text-sm font-medium text-white/70 mb-2" %>
      <%= f.text_area :deliverables, rows: 4, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors resize-none", placeholder: t("proposals.deliverables_placeholder") %>
    </div>
  </div>

  <!-- Timeline -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
    <h2 class="text-lg font-semibold text-white mb-5"><%= t("proposals.timeline") %></h2>
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
      <div>
        <%= f.label :timeline_start, t("proposals.timeline_start"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <%= f.date_field :timeline_start, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors" %>
      </div>

      <div>
        <%= f.label :timeline_end, t("proposals.timeline_end"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <%= f.date_field :timeline_end, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors" %>
      </div>
    </div>
  </div>

  <!-- Pricing -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6" data-controller="pricing">
    <h2 class="text-lg font-semibold text-white mb-5"><%= t("proposals.pricing") %></h2>

    <div class="space-y-5">
      <div>
        <%= f.label :pricing_type, t("proposals.pricing_type"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <%= f.select :pricing_type,
            Proposal.pricing_types.keys.map { |pt| [t("proposals.pricing_types.#{pt}"), pt] },
            {},
            { class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", data: { pricing_target: "type", action: "change->pricing#toggle" } } %>
      </div>

      <div data-pricing-target="fixed" class="<%= 'hidden' unless proposal.fixed? || proposal.new_record? %>">
        <%= f.label :amount, t("proposals.amount"), class: "block text-sm font-medium text-white/70 mb-2" %>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <span class="text-white/40">$</span>
          </div>
          <%= f.number_field :amount, step: 0.01, min: 0, class: "w-full pl-8 px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", placeholder: "0.00" %>
        </div>
      </div>

      <div data-pricing-target="hourly" class="<%= 'hidden' if proposal.fixed? || proposal.new_record? %> space-y-5">
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
          <div>
            <%= f.label :hourly_rate, t("proposals.hourly_rate"), class: "block text-sm font-medium text-white/70 mb-2" %>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <span class="text-white/40">$</span>
              </div>
              <%= f.number_field :hourly_rate, step: 0.01, min: 0, class: "w-full pl-8 px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", placeholder: "0.00" %>
            </div>
          </div>

          <div>
            <%= f.label :estimated_hours, t("proposals.estimated_hours"), class: "block text-sm font-medium text-white/70 mb-2" %>
            <%= f.number_field :estimated_hours, step: 0.5, min: 0, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", placeholder: "0" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Terms -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
    <div>
      <%= f.label :terms, t("proposals.terms"), class: "block text-sm font-medium text-white/70 mb-2" %>
      <%= f.text_area :terms, rows: 4, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors resize-none", placeholder: t("proposals.terms_placeholder") %>
    </div>
  </div>

  <!-- Expiration -->
  <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
    <div>
      <%= f.label :expires_at, t("proposals.expires_at"), class: "block text-sm font-medium text-white/70 mb-2" %>
      <%= f.datetime_local_field :expires_at, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors" %>
      <p class="mt-2 text-xs text-white/40"><%= t("proposals.expires_at_hint") %></p>
    </div>
  </div>

  <!-- Submit -->
  <div class="flex justify-end gap-3 pt-4">
    <%= link_to t("common.cancel"), proposals_path, class: "px-5 py-2.5 bg-white/10 text-white text-sm font-medium rounded-full hover:bg-white/20 transition-all duration-200" %>
    <%= f.submit class: "px-6 py-2.5 bg-white text-black text-sm font-semibold rounded-full hover:bg-white/90 transition-all duration-200 cursor-pointer" %>
  </div>
<% end %>

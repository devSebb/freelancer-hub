<div>
  <!-- Page Header -->
  <div class="mb-10">
    <h1 class="text-4xl font-bold text-white tracking-tight"><%= t("settings.title") %></h1>
    <p class="mt-2 text-white/50">Manage your account and preferences</p>
  </div>

  <%= form_with model: @user, url: settings_path, method: :patch, class: "space-y-6" do |f| %>
    <% if @user.errors.any? %>
      <div class="bg-red-400/10 border border-red-400/20 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <%= icon(:error, size: :md, css_class: "text-red-400 flex-shrink-0 mt-0.5") %>
          <ul class="text-sm text-red-400 space-y-1">
            <% @user.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>

    <!-- Profile Section -->
    <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
      <h2 class="text-lg font-semibold text-white"><%= t("settings.profile") %></h2>
      <p class="mt-1 text-sm text-white/50"><%= t("settings.profile_description") %></p>

      <div class="mt-6 grid grid-cols-1 gap-5 sm:grid-cols-2">
        <div>
          <%= f.label :name, t("settings.name"), class: "block text-sm font-medium text-white/70 mb-2" %>
          <%= f.text_field :name, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", placeholder: "John Doe" %>
        </div>

        <div>
          <%= f.label :email, t("settings.email"), class: "block text-sm font-medium text-white/70 mb-2" %>
          <%= f.email_field :email, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white/50 cursor-not-allowed", disabled: true %>
          <p class="mt-2 text-xs text-white/40">Email cannot be changed here.</p>
        </div>

        <div class="sm:col-span-2">
          <%= f.label :business_name, t("settings.business_name"), class: "block text-sm font-medium text-white/70 mb-2" %>
          <%= f.text_field :business_name, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors", placeholder: "Acme Consulting" %>
        </div>

        <div class="sm:col-span-2">
          <%= f.label :address, t("settings.address"), class: "block text-sm font-medium text-white/70 mb-2" %>
          <%= f.text_area :address, rows: 3, class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 focus:outline-none focus:border-white/30 focus:ring-0 transition-colors resize-none", placeholder: "123 Main St\nNew York, NY 10001" %>
        </div>
      </div>
    </div>

    <!-- Language Section -->
    <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
      <h2 class="text-lg font-semibold text-white"><%= t("settings.language") %></h2>
      <p class="mt-1 text-sm text-white/50"><%= t("settings.language_description") %></p>

      <div class="mt-6">
        <%= f.select :language,
            User.languages.keys.map { |lang| [t("settings.languages.#{lang}"), lang] },
            {},
            class: "w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-white/30 focus:ring-0 transition-colors" %>
      </div>
    </div>

    <!-- Logo Section -->
    <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
      <h2 class="text-lg font-semibold text-white"><%= t("settings.logo") %></h2>
      <p class="mt-1 text-sm text-white/50"><%= t("settings.logo_description") %></p>

      <div class="mt-6">
        <% if @user.logo.attached? %>
          <div class="mb-4">
            <p class="text-sm font-medium text-white/70 mb-3"><%= t("settings.current_logo") %></p>
            <div class="inline-flex items-center p-4 bg-white/5 rounded-xl border border-white/10">
              <%= image_tag @user.logo.variant(resize_to_limit: [200, 80]), class: "h-12 max-w-[160px] object-contain" %>
            </div>
          </div>
        <% end %>

        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-white/10 border-dashed rounded-xl cursor-pointer bg-white/5 hover:bg-white/10 hover:border-white/20 transition-all duration-200">
          <div class="flex flex-col items-center justify-center py-6">
            <%= icon(:upload, size: :lg, css_class: "w-8 h-8 mb-3 text-white/40") %>
            <p class="mb-1 text-sm text-white/60"><span class="font-medium text-white">Click to upload</span></p>
            <p class="text-xs text-white/40">PNG, JPG, WebP (max 2MB)</p>
          </div>
          <%= f.file_field :logo, accept: "image/png,image/jpeg,image/webp", class: "hidden" %>
        </label>
      </div>
    </div>

    <!-- Submit -->
    <div class="flex justify-end pt-4">
      <%= f.submit t("settings.save_changes"), class: "px-6 py-3 bg-white text-black font-semibold rounded-full hover:bg-white/90 transition-all duration-200 cursor-pointer" %>
    </div>
  <% end %>

  <!-- Billing Section -->
  <div class="mt-6 bg-white/5 border border-white/10 rounded-2xl p-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h2 class="text-lg font-semibold text-white"><%= t("billing.section_title") %></h2>
        <p class="mt-1 text-sm text-white/50"><%= t("billing.section_description") %></p>
      </div>
      <div class="inline-flex items-center px-4 py-2 rounded-full border border-white/15 bg-white/5">
        <span class="text-xs uppercase tracking-wider text-white/60"><%= t("billing.current_plan_label") %></span>
        <span class="ml-2 text-sm font-semibold text-accent"><%= t("billing.plan_names.#{@billing_plan}") %></span>
      </div>
    </div>

    <% if @billing_activating %>
      <div class="mt-5 rounded-xl border border-blue-400/30 bg-blue-400/10 px-4 py-3">
        <p class="text-sm text-blue-300"><%= t("billing.activating") %></p>
      </div>
    <% end %>

    <% if @billing_subscription&.current_period_end.present? %>
      <div class="mt-5 rounded-xl border border-white/10 bg-white/5 px-4 py-3">
        <% if @billing_subscription.cancel_at_period_end? %>
          <p class="text-sm text-white/70">
            <%= t("billing.cancels_on", date: l(@billing_subscription.current_period_end.to_date, format: :long)) %>
          </p>
        <% else %>
          <p class="text-sm text-white/70">
            <%= t("billing.renews_on", date: l(@billing_subscription.current_period_end.to_date, format: :long)) %>
          </p>
        <% end %>
      </div>
    <% end %>

    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3">
      <% [
        [:clients, t("billing.usage.clients"), false],
        [:proposals, t("billing.usage.proposals"), true],
        [:invoices, t("billing.usage.invoices"), true],
        [:templates, t("billing.usage.templates"), false]
      ].each do |resource, label, monthly| %>
        <% data = @billing_usage[resource] %>
        <div class="rounded-xl border border-white/10 bg-black/20 px-4 py-3">
          <p class="text-xs text-white/45 uppercase tracking-wider"><%= label %></p>
          <p class="mt-1 text-white font-semibold">
            <% if data[:limit].nil? %>
              <%= t("billing.unlimited") %>
            <% else %>
              <%= "#{data[:usage]}/#{data[:limit]}" %>
              <% if monthly %>
                <span class="text-xs text-white/40 ml-1"><%= t("billing.per_month") %></span>
              <% end %>
            <% end %>
          </p>
        </div>
      <% end %>
    </div>

    <% if @show_upgrade_nudge %>
      <div class="mt-5 rounded-xl border border-accent/30 bg-accent/10 px-4 py-3">
        <p class="text-sm text-accent"><%= t("billing.upgrade_nudge") %></p>
      </div>
    <% end %>

    <div class="mt-6 flex flex-wrap gap-3">
      <% if @user.pro? %>
        <%= button_to t("billing.manage_subscription"), billing_portal_path, method: :post, data: { turbo: false },
                      class: "px-5 py-2.5 bg-white text-black text-sm font-semibold rounded-full hover:bg-white/90 transition-all duration-200 cursor-pointer" %>
      <% else %>
        <%= button_to t("billing.actions.upgrade_starter_monthly"), billing_checkout_path(tier: "starter", interval: "monthly"), method: :post, data: { turbo: false },
                      class: "px-5 py-2.5 bg-accent text-black text-sm font-semibold rounded-full hover:bg-accent-light transition-all duration-200 cursor-pointer" %>
        <%= button_to t("billing.actions.upgrade_starter_yearly"), billing_checkout_path(tier: "starter", interval: "yearly"), method: :post, data: { turbo: false },
                      class: "px-5 py-2.5 bg-white/10 border border-white/20 text-white text-sm font-semibold rounded-full hover:bg-white/20 transition-all duration-200 cursor-pointer" %>
        <%= button_to t("billing.actions.view_all_plans"), pricing_path,
                      method: :get,
                      class: "px-5 py-2.5 bg-transparent border border-white/20 text-white text-sm font-semibold rounded-full hover:border-white/35 transition-all duration-200 cursor-pointer" %>
      <% end %>
    </div>
  </div>
</div>
